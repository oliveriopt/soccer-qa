
{
  "name": "op-sql-qa-pqt-to-gcs",
  "description": "Exporta datos desde SQL Server a Parquet en GCS y ejecuta hasta 5 queries de QA desde qa_query_plan filtradas por check_type.",
  "parameters": [
    {
      "name": "gcp_project",
      "label": "GCP Project ID",
      "helpText": "ID del proyecto GCP donde se ejecuta Dataflow",
      "paramType": "TEXT",
      "isOptional": false
    },
    {
      "name": "region",
      "label": "GCP Region",
      "helpText": "Región de ejecución de Dataflow (por ejemplo, us-central1)",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "staging_location",
      "label": "GCS staging location",
      "helpText": "Ruta en GCS para staging (gs://...)",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "temp_location",
      "label": "GCS temp location",
      "helpText": "Ruta en GCS para archivos temporales (gs://...)",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "connection_name",
      "label": "Connection alias",
      "helpText": "Alias de conexión a SQL Server (ej: fo, bdw) o usa secret_id",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "secret_id",
      "label": "Secret Manager ID",
      "helpText": "Nombre del secreto en Secret Manager que contiene la cadena de conexión",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "query",
      "label": "Query principal",
      "helpText": "Consulta SQL para extraer la tabla principal desde SQL Server",
      "paramType": "TEXT",
      "isOptional": false
    },
    {
      "name": "data_output_path",
      "label": "GCS output path para Parquet",
      "helpText": "Ruta en GCS donde se guardará el Parquet exportado",
      "paramType": "TEXT",
      "isOptional": false
    },
    {
      "name": "table_catalog",
      "label": "Table Catalog",
      "helpText": "Nombre del catálogo de la tabla (BBDD)",
      "paramType": "TEXT",
      "isOptional": false
    },
    {
      "name": "table_schema",
      "label": "Table Schema",
      "helpText": "Esquema de la tabla",
      "paramType": "TEXT",
      "isOptional": false
    },
    {
      "name": "table_name",
      "label": "Table Name",
      "helpText": "Nombre de la tabla",
      "paramType": "TEXT",
      "isOptional": false
    },
    {
      "name": "qa_check_types",
      "label": "QA Check Types",
      "helpText": "Lista CSV de tipos de chequeo QA (ej: count_total_rows,hashcheck). Vacío = todos.",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "qa_limit",
      "label": "Límite de QA Queries",
      "helpText": "Número máximo de queries QA a ejecutar (default 5)",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "qa_results_table",
      "label": "BQ QA Results Table",
      "helpText": "Tabla en BigQuery donde se guardarán los resultados QA (project.dataset.table)",
      "paramType": "TEXT",
      "isOptional": false
    },
    {
      "name": "service_account_email",
      "label": "Service Account Email",
      "helpText": "Cuenta de servicio para ejecutar Dataflow",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "subnetwork",
      "label": "Subnetwork",
      "helpText": "Subred de VPC para ejecutar Dataflow",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "disable_public_ips",
      "label": "Disable Public IPs",
      "helpText": "true/false para deshabilitar IPs públicas",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "num_workers",
      "label": "Número inicial de workers",
      "helpText": "Cantidad inicial de workers para Dataflow",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "max_num_workers",
      "label": "Máximo número de workers",
      "helpText": "Cantidad máxima de workers para Dataflow",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "autoscaling_algorithm",
      "label": "Algoritmo de autoscaling",
      "helpText": "Tipo de autoscaling (NONE, THROUGHPUT_BASED)",
      "paramType": "TEXT",
      "isOptional": true
    },
    {
      "name": "machine_type",
      "label": "Tipo de máquina",
      "helpText": "Ej: n1-standard-4, e2-highmem-4",
      "paramType": "TEXT",
      "isOptional": true
    }
  ]
}